<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Dodge Rain</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg0:#fff6e5;
      --bg1:#ffd9a3;
      --bg2:#fff1cc;
      --ink:#2d1600;
      --pastel-pink:#ff5f9c;
      --pastel-blue:#46a0ff;
      --pastel-mint:#00d9b8;
      --pastel-peach:#ffca3a;
      --accent:#ff595e;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      background:var(--bg0);
      height:100svh;
      overflow:hidden;
      gap:12px;
      font-family:'Press Start 2P',ui-monospace,monospace;
      color:var(--ink);
    }
    h1{margin:0;font-size:18px;}
    .play{
      flex:1;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    #gameCanvas{
      background:var(--bg2);
      border:4px solid var(--pastel-peach);
      image-rendering:pixelated;
      box-shadow:0 10px 20px rgba(0,0,0,0.2);
    }
    #score{margin:0;font-size:14px;}
    #controls{display:flex;gap:12px;}
    button{
      padding:8px 12px;
      font-size:14px;
      background:var(--pastel-pink);
      border:2px solid var(--accent);
      border-radius:8px;
      color:var(--ink);
      cursor:pointer;
    }
    button:active{transform:translateY(2px);}

    #msg{
      position:fixed;
      top:16px;
      left:50%;
      transform:translateX(-50%);
      background:var(--pastel-pink);
      border:2px solid var(--accent);
      border-radius:8px;
      padding:8px 12px;
      font-size:14px;
      color:var(--ink);
      box-shadow:0 4px 8px rgba(0,0,0,0.2);
      display:none;
    }
  </style>
</head>
<body>
  <h1>Dodge Rain</h1>
  <div id="score">Счёт: 0</div>
  <div id="controls">
    <button id="startBtn">Старт</button>
    <button id="resetBtn">Сброс</button>
  </div>
  <div class="play">
    <canvas id="gameCanvas" width="160" height="120"></canvas>
  </div>
  <div id="msg" aria-live="polite"></div>
  <script>
  (function(){
    'use strict';
    const canvas=document.getElementById('gameCanvas');
    const ctx=canvas.getContext('2d',{alpha:false});
    ctx.imageSmoothingEnabled=false;
    let running=false;
    let player, objects, spawnTimer, score;
    const scoreEl=document.getElementById('score');
    const startBtn=document.getElementById('startBtn');
    const resetBtn=document.getElementById('resetBtn');
    const header=document.querySelector('h1');
    const controls=document.getElementById('controls');
    const msg=document.getElementById('msg');

    function notify(text){
      msg.textContent=text;
      msg.style.display='block';
      setTimeout(()=>{msg.style.display='none';},2000);
    }

    function resize(){
      const availableHeight=window.innerHeight - header.offsetHeight - scoreEl.offsetHeight - controls.offsetHeight - 36;
      const availableWidth=window.innerWidth;
      const ratio=canvas.width/canvas.height;
      let w=availableWidth;
      let h=w/ratio;
      if(h>availableHeight){h=availableHeight; w=h*ratio;}
      canvas.style.width=w+'px';
      canvas.style.height=h+'px';
    }
    window.addEventListener('resize',resize);
    function resetGame(){
      running=false;
      player={x:canvas.width/2-5,y:canvas.height-10,w:10,h:5};
      objects=[];
      spawnTimer=0;
      score=0;
      scoreEl.textContent='Счёт: '+score;
      draw();
    }
    function spawnObject(){
      const size=4;
      objects.push({x:Math.random()*(canvas.width-size),y:-size,w:size,h:size,vy:1+Math.random()*1,color:pickColor()});
      if(objects.length>50) objects.shift();
    }
    function pickColor(){
      const vars=['--pastel-peach','--pastel-mint','--pastel-blue','--pastel-pink'];
      return getComputedStyle(document.documentElement).getPropertyValue(vars[Math.floor(Math.random()*vars.length)]);
    }
    function update(){
      if(!running) return;
      spawnTimer++;
      if(spawnTimer>20){
        spawnObject();
        spawnTimer=0;
      }
      for(const o of objects){
        o.y+=o.vy;
      }
      objects = objects.filter(o=>{
        if(o.y>canvas.height){ score++; scoreEl.textContent='Счёт: '+score; return false; }
        return true;
      });
      for(const o of objects){
        if(o.x<player.x+player.w && o.x+o.w>player.x && o.y<player.y+player.h && o.y+o.h>player.y){
          running=false;
          notify('Столкновение! Счёт: '+score);
          break;
        }
      }
      draw();
      requestAnimationFrame(update);
    }
    function draw(){
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--bg2');
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--pastel-blue');
      ctx.fillRect(player.x,player.y,player.w,player.h);
      for(const o of objects){
        ctx.fillStyle=o.color;
        ctx.fillRect(o.x,o.y,o.w,o.h);
      }
    }
    function movePlayerTo(x){
      const half=player.w/2;
      player.x=Math.min(Math.max(x-half,0),canvas.width-player.w);
    }
    canvas.addEventListener('mousemove',e=>{
      const rect=canvas.getBoundingClientRect();
      movePlayerTo(e.clientX-rect.left);
    });
    canvas.addEventListener('touchmove',e=>{
      const rect=canvas.getBoundingClientRect();
      const t=e.touches[0];
      movePlayerTo(t.clientX-rect.left);
      e.preventDefault();
    },{passive:false});
    document.addEventListener('keydown',e=>{
      const k=e.key.toLowerCase();
      if(k==='arrowleft' || k==='a') movePlayerTo(player.x-10);
      else if(k==='arrowright' || k==='d') movePlayerTo(player.x+10);
    });
    startBtn.addEventListener('click',()=>{
      if(!running){
        running=true;
        requestAnimationFrame(update);
      }
    });
    resetBtn.addEventListener('click',resetGame);
    resize();
    resetGame();
  })();
  </script>
</body>
</html>

