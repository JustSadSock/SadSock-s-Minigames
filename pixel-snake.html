<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Pixel Snake</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root{
      /* пастельные цвета из SadSock’s minigames */
      --bg0:#fff6e5;
      --bg1:#ffd9a3;
      --bg2:#fff1cc;
      --ink:#2d1600;
      --pastel-pink:#ff5f9c;
      --pastel-blue:#46a0ff;
      --pastel-mint:#00d9b8;
      --pastel-peach:#ffca3a;
      --accent:#ff595e;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      height:100svh;
      overflow:hidden;
      background:var(--bg0);
      gap:12px;
      font-family:'Press Start 2P',ui-monospace,monospace;
      color:var(--ink);
    }
    h1{margin:0;font-size:18px;}
    .play{
      flex:1;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    #gameCanvas{
      image-rendering:pixelated;
      background:var(--bg2);
      border:4px solid var(--pastel-peach);
      box-shadow:0 10px 20px rgba(0,0,0,0.2);
    }
    #score{margin:0;font-size:14px;}
    #controls{display:flex;gap:12px;}
    button{
      padding:8px 12px;
      font-size:14px;
      background:var(--pastel-pink);
      border:2px solid var(--accent);
      border-radius:8px;
      color:var(--ink);
      cursor:pointer;
    }
    button:active{transform:translateY(2px);}

    .overlay{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.6);
      display:none;
      align-items:center;
      justify-content:center;
    }
    .overlay .panel{
      background:var(--pastel-pink);
      border:2px solid var(--accent);
      border-radius:8px;
      padding:16px;
      text-align:center;
      color:var(--ink);
    }
    .overlay .panel p{
      margin:0 0 12px;
      font-size:14px;
    }
    .overlay .panel button{margin-top:8px;}
  </style>
</head>
<body>
  <h1>Pixel Snake</h1>
  <div id="score">Счёт: 0</div>
  <div id="controls">
    <button id="startBtn">Старт</button>
    <button id="resetBtn">Сброс</button>
  </div>
  <div class="play">
    <canvas id="gameCanvas" width="160" height="120"></canvas>
    <div id="overlay" class="overlay">
      <div class="panel">
        <p id="msg"></p>
        <button id="againBtn">Сыграть ещё</button>
        <button id="exitBtn">Выход</button>
      </div>
    </div>
  </div>
  <script>
  (function(){
    'use strict';
    const canvas=document.getElementById('gameCanvas');
    const ctx=canvas.getContext('2d',{alpha:false});
    ctx.imageSmoothingEnabled=false;
    let gameInterval=null;
    const cellSize=5;
    const cols=Math.floor(canvas.width / cellSize);
    const rows=Math.floor(canvas.height / cellSize);
    let snake, dir, nextDir, apple, score;
    const scoreEl=document.getElementById('score');
    const startBtn=document.getElementById('startBtn');
    const resetBtn=document.getElementById('resetBtn');
    const header=document.querySelector('h1');
    const controls=document.getElementById('controls');
    const overlay=document.getElementById('overlay');
    const msg=document.getElementById('msg');
    const againBtn=document.getElementById('againBtn');
    const exitBtn=document.getElementById('exitBtn');

    function notify(text){
      msg.textContent=text;
      overlay.style.display='flex';
      startBtn.disabled=true;
      resetBtn.disabled=true;
      againBtn.onclick=()=>{
        overlay.style.display='none';
        startBtn.disabled=false;
        resetBtn.disabled=false;
        resetGame();
        draw();
      };
    }
    exitBtn.onclick=()=>{window.top.location.href='index.html';};

    function resize(){
      const availableHeight=window.innerHeight - header.offsetHeight - scoreEl.offsetHeight - controls.offsetHeight - 36;
      const availableWidth=window.innerWidth;
      const ratio=canvas.width/canvas.height;
      let w=availableWidth;
      let h=w/ratio;
      if(h>availableHeight){h=availableHeight; w=h*ratio;}
      canvas.style.width=w+'px';
      canvas.style.height=h+'px';
    }
    window.addEventListener('resize',resize);

    function resetGame(){
      overlay.style.display='none';
      startBtn.disabled=false;
      resetBtn.disabled=false;
      snake=[{x:Math.floor(cols/2), y:Math.floor(rows/2)}];
      dir={x:1,y:0};
      nextDir={x:1,y:0};
      apple=spawnApple();
      score=0;
      scoreEl.textContent='Счёт: '+score;
      clearInterval(gameInterval);
      gameInterval=null;
    }
    function spawnApple(){
      let pos;
      do{
        pos={x:Math.floor(Math.random()*cols),y:Math.floor(Math.random()*rows)};
      }while(snake.some(s=>s.x===pos.x && s.y===pos.y));
      return pos;
    }
    function update(){
      dir=nextDir;
      const head={x:(snake[0].x+dir.x+cols)%cols, y:(snake[0].y+dir.y+rows)%rows};
      if(snake.some(s=>s.x===head.x && s.y===head.y)){
        clearInterval(gameInterval);
        gameInterval=null;
        notify('Игра окончена! Ваш счёт: '+score);
        return;
      }
      snake.unshift(head);
      if(head.x===apple.x && head.y===apple.y){
        score++;
        scoreEl.textContent='Счёт: '+score;
        apple=spawnApple();
      }else{
        snake.pop();
      }
      draw();
    }
    function draw(){
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--bg2');
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--pastel-peach');
      ctx.fillRect(apple.x*cellSize, apple.y*cellSize, cellSize, cellSize);
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--pastel-mint');
      for(const s of snake){
        ctx.fillRect(s.x*cellSize, s.y*cellSize, cellSize, cellSize);
      }
    }
    function startGame(){
      if(gameInterval) return;
      gameInterval=setInterval(update,150);
    }
    document.addEventListener('keydown',e=>{
      const key=e.key.toLowerCase();
      if((key==='arrowup' || key==='w') && dir.y===0) nextDir={x:0,y:-1};
      else if((key==='arrowdown' || key==='s') && dir.y===0) nextDir={x:0,y:1};
      else if((key==='arrowleft' || key==='a') && dir.x===0) nextDir={x:-1,y:0};
      else if((key==='arrowright' || key==='d') && dir.x===0) nextDir={x:1,y:0};
    });
    let touchStartX=0, touchStartY=0;
    canvas.addEventListener('touchstart',e=>{
      const t=e.touches[0];
      touchStartX=t.clientX; touchStartY=t.clientY;
    },{passive:true});
    canvas.addEventListener('touchend',e=>{
      const t=e.changedTouches[0];
      const dx=t.clientX-touchStartX;
      const dy=t.clientY-touchStartY;
      if(Math.abs(dx)>Math.abs(dy)){
        if(dx>20 && dir.x===0) nextDir={x:1,y:0};
        else if(dx<-20 && dir.x===0) nextDir={x:-1,y:0};
      }else{
        if(dy>20 && dir.y===0) nextDir={x:0,y:1};
        else if(dy<-20 && dir.y===0) nextDir={x:0,y:-1};
      }
    },{passive:true});
    startBtn.addEventListener('click',startGame);
    resetBtn.addEventListener('click',()=>{
      resetGame();
      draw();
    });
    resize();
    resetGame();
    draw();
  })();
  </script>
</body>
</html>
