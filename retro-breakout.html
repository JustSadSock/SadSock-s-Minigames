<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Retro Breakout</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg0:#fff4cf;
      --bg1:#f6e7c0;
      --bg2:#f2dba9;
      --ink:#3a2c1b;
      --pastel-pink:#e6a84a;
      --pastel-blue:#d79031;
      --pastel-mint:#e7c888;
      --pastel-peach:#ffe6a6;
      --accent:#d79031;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      height:100svh;
      overflow:hidden;
      background:var(--bg0);
      gap:12px;
      font-family:'Press Start 2P',ui-monospace,monospace;
      color:var(--ink);
    }
    h1{margin:0;font-size:18px;}
    .play{
      flex:1;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    #gameCanvas{
      background:var(--bg2);
      border:4px solid var(--pastel-peach);
      box-shadow:0 10px 20px rgba(0,0,0,0.2);
      image-rendering:pixelated;
    }
    #score{margin:0;font-size:14px;}
    #controls{display:flex;gap:12px;}
    button{
      padding:8px 12px;
      font-size:14px;
      background:var(--pastel-peach);
      border:1px solid var(--accent);
      border-radius:8px;
      color:var(--ink);
      cursor:pointer;
      box-shadow:0 2px 0 rgba(255,255,255,0.6) inset;
    }
    button:active{transform:translateY(1px);}

    .toast{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      background:var(--pastel-pink);
      border:1px solid var(--accent);
      border-radius:8px;
      padding:12px 16px;
      font-size:14px;
      display:none;
      color:var(--ink);
    }
    .pad{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:12px;}
    .pad button{width:50px;height:50px;padding:0;}
    @media (min-width:600px){.pad{display:none;}}
  </style>
</head>
<body>
  <h1>Retro Breakout</h1>
  <div id="score">Счёт: 0</div>
  <div id="controls">
    <button id="startBtn">Старт</button>
    <button id="resetBtn">Сброс</button>
    <button id="exitBtn">Выход</button>
  </div>
  <div class="play">
    <canvas id="gameCanvas" width="120" height="160"></canvas>
    <div id="toast" class="toast"></div>
    <div id="pad" class="pad">
      <button data-dir="left">◄</button>
      <button data-dir="right">►</button>
    </div>
  </div>
  <script>
  (function(){
    'use strict';
    const canvas=document.getElementById('gameCanvas');
    const ctx=canvas.getContext('2d',{alpha:false});
    ctx.imageSmoothingEnabled=false;
    let gameRunning=false;
    let ball, paddle, bricks, brickRows=4, brickCols=8;
    let score=0;
    const scoreEl=document.getElementById('score');
    const startBtn=document.getElementById('startBtn');
    const resetBtn=document.getElementById('resetBtn');
    const exitBtn=document.getElementById('exitBtn');
    const paddleWidth=30;
    const header=document.querySelector('h1');
    const controls=document.getElementById('controls');
    const toastEl=document.getElementById('toast');
    const pad=document.getElementById('pad');
    let left=false,right=false;

    function toast(text){
      toastEl.textContent=text;
      toastEl.style.display='block';
      setTimeout(()=> toastEl.style.display='none',2000);
    }
    exitBtn.onclick=()=>{window.top.location.href='index.html';};

    function resize(){
      const availableHeight=window.innerHeight - header.offsetHeight - scoreEl.offsetHeight - controls.offsetHeight - 36;
      const availableWidth=window.innerWidth;
      const ratio=canvas.width/canvas.height;
      let w=availableWidth;
      let h=w/ratio;
      if(h>availableHeight){h=availableHeight; w=h*ratio;}
      canvas.style.width=w+'px';
      canvas.style.height=h+'px';
    }
    window.addEventListener('resize',resize);
    function resetGame(){
      gameRunning=false;
      score=0;
      updateScore();
      ball={x:canvas.width/2,y:canvas.height-20,dx:2,dy:-2,r:2};
      paddle={x:(canvas.width-paddleWidth)/2,y:canvas.height-10,w:paddleWidth,h:4};
      bricks=[];
      const bw=canvas.width/brickCols;
      const bh=10;
      for(let r=0;r<brickRows;r++){
        for(let c=0;c<brickCols;c++){
          bricks.push({x:c*bw,y:20+r*(bh+2),w:bw-2,h:bh,alive:true,color:getBrickColor(r)});
        }
      }
      draw();
    }
    function getBrickColor(row){
      const colors=['--pastel-peach','--pastel-mint','--pastel-blue','--pastel-pink'];
      return getComputedStyle(document.documentElement).getPropertyValue(colors[row%colors.length]);
    }
    function updateScore(){scoreEl.textContent='Счёт: '+score;}
    function draw(){
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--bg2');
      ctx.fillRect(0,0,canvas.width,canvas.height);
      for(const b of bricks){
        if(b.alive){
          ctx.fillStyle=b.color;
          ctx.fillRect(b.x,b.y,b.w,b.h);
        }
      }
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--pastel-blue');
      ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--pastel-pink');
      ctx.fillRect(ball.x-ball.r,ball.y-ball.r,ball.r*2,ball.r*2);
    }
    function loop(){
      if(!gameRunning) return;
      if(left) setPaddle(paddle.x-4);
      if(right) setPaddle(paddle.x+4);
      ball.x+=ball.dx;
      ball.y+=ball.dy;
      if(ball.x<ball.r || ball.x>canvas.width-ball.r) ball.dx*=-1;
      if(ball.y<ball.r) ball.dy*=-1;
      if(ball.y>canvas.height-ball.r){
        gameRunning=false;
        toast('Счёт: '+score);
        resetGame();
      }
      if(ball.y+ball.r>=paddle.y && ball.x>=paddle.x && ball.x<=paddle.x+paddle.w){
        ball.dy=-Math.abs(ball.dy);
        const offset=(ball.x-(paddle.x+paddle.w/2))/(paddle.w/2);
        ball.dx=2*offset;
      }
      for(const b of bricks){
        if(b.alive && ball.x>=b.x && ball.x<=b.x+b.w && ball.y>=b.y && ball.y<=b.y+b.h){
          b.alive=false;
          ball.dy*=-1;
          score++;
          updateScore();
          break;
        }
      }
      draw();
      requestAnimationFrame(loop);
    }
    function setPaddle(left){
      paddle.x=Math.min(Math.max(left,0),canvas.width-paddle.w);
    }
    canvas.addEventListener('mousemove',e=>{
      const rect=canvas.getBoundingClientRect();
      setPaddle(e.clientX-rect.left - paddle.w/2);
    });
    canvas.addEventListener('touchmove',e=>{
      const rect=canvas.getBoundingClientRect();
      const t=e.touches[0];
      setPaddle(t.clientX-rect.left - paddle.w/2);
      e.preventDefault();
    },{passive:false});
    document.addEventListener('keydown',e=>{
      const k=e.key.toLowerCase();
      if(k==='arrowleft' || k==='a') left=true;
      else if(k==='arrowright' || k==='d') right=true;
    });
    document.addEventListener('keyup',e=>{
      const k=e.key.toLowerCase();
      if(k==='arrowleft' || k==='a') left=false;
      else if(k==='arrowright' || k==='d') right=false;
    });
    pad.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('touchstart',e=>{
        e.preventDefault();
        if(btn.dataset.dir==='left') left=true; else right=true;
      },{passive:false});
      btn.addEventListener('touchend',e=>{
        e.preventDefault();
        if(btn.dataset.dir==='left') left=false; else right=false;
      },{passive:false});
    });
    startBtn.addEventListener('click',()=>{
      if(!gameRunning){
        gameRunning=true;
        requestAnimationFrame(loop);
      }
    });
    resetBtn.addEventListener('click',resetGame);
    resize();
    resetGame();
  })();
  </script>
</body>
</html>

